<html>
  <body>
    <div id="root"></div>
    
    <script type="text/javascript">
    //Model
    var model = {
      inbox: false,
      archive: false,
      all_todos: [
      {
        text: "Read about SAM",
        archived: false
      },
      {
        text: 'Write code for an example',
        archived: true
      },
      {
        text: 'Create real world app using SAM',
        archived: false
      },
      {
        text: 'Celebrate',
        archived: false
      }
      ],
    };

		model.isArchived = function(todo) {
		  return todo.archived == true;
		}

		model.isInbox = function(todo) {
		  return todo.archived == false;
		}

		model.present = function(data) {
		  //subsequent models toggle content based on action
		  if (state.inbox(model)) {
		    model.archive = data.archive || false;
		    model.inbox = data.inbox || false;
		    if (data.todos !== undefined) {
		      model.todos = data.todos.filter(model.isArchived);
		    }
		  } else if (state.archived(model)) {
		    model.archive = data.archive || false;
		    model.inbox = data.inbox || false;
		    if (data.todos !== undefined) {
		      model.todos = data.todos.filter(model.isInbox);
		    }
		  }
		  //initial model is aligned with first action
		  if (state.ready(model)) {
		    model.archive = data.archive || false;
		    model.inbox = data.inbox || false;
		    if (data.todos !== undefined) {
		      if (model.inbox) {
		        model.todos = data.todos.filter(model.isInbox);
		      } else {
		        model.todos = data.todos.filter(model.isArchived);
		      }
		    }
		  }
		  state.render(model);
		}


    //View
    var view = {};

    view.init = function(model) {
      return ("<h2>Todo</h2><form onSubmit=\"JavaScript:return actions.inbox({});\">\n\
      <input type=\"submit\" value=\"View Inbox\">\n\
      </form>\n\
      <form onSubmit=\"JavaScript:return actions.archived({});\">\n\
      <input type=\"submit\" value=\"View Archives\">\n\
      </form>");
      }

    view.archived = function(model) {
      return ("<h2>Todo</h2><ul>" + model.todos.map(function(obj) {
        return ('<li>' + obj.text + '</li>');}).join('') + 
        "</ul><form onSubmit=\"JavaScript:return actions.inbox({});\">\n\
        <input type=\"submit\" value=\"View Inbox\">\n\
        </form>");
    }

    view.inbox = function(model) {
      return ("<h2>Todo</h2><ul>" + model.todos.map(function(obj) {
        return ('<li>' + obj.text + '</li>');}).join('') + 
        "</ul><form onSubmit=\"JavaScript:return actions.archived({});\">\n\
        <input type=\"submit\" value=\"View Archives\">\n\
        </form>");
    }

    view.display = function(root) {
      var stateroot = document.getElementById("root");
      stateroot.innerHTML = root;
    }

    view.display(view.init(model));


    //State
    var state = {
      view: view
    };

    model.state = state;

    state.root = function(model) {
      var root = "The system is in an invalid state.";

      if (state.inbox(model)) {
        root = state.view.inbox(model);
      }

      if (state.archived(model)) {
        root = state.view.archived(model);
      }

      state.view.display(root);
    }

    state.ready = function(model) {
      return (!model.inbox && !model.archive)
    }

    state.inbox = function(model) {
      return (model.inbox);
    }

    state.archived = function(model) {
      return (model.archive)
    }

    state.render = function(model) {
      state.root(model);
    }


    //Actions
    var actions = {};

    //user clicked View Inbox
    actions.inbox = function(data, present) {
      present = present || model.present;
      data = data || {};
      data.inbox = true;
      data.archive = false;
      data.todos = model.all_todos;
      present(data);
      return false;
    }

    //User clicked View Archives
    actions.archived = function(data, present) {
      present = present || model.present;
      data = data || {};
      data.todos = model.all_todos;
      data.inbox = false;
      data.archive = true;
      present(data);
      return false;
    }
	  </script>
	</body>
</html>
